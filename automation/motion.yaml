  - alias: Turn on downstains lights early morning
    hide_entity: false
    trigger:
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_1_sensor
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_2_sensor
        from: 'off'
        to: 'on'
    condition:
      - condition: state
        entity_id: input_boolean.disable_downstairs_motion
        state: 'off'
      - condition: state
        entity_id: group.downstairs_all_lights
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.downstairs_motion_detector_1_luminance
        below: '18'
      - condition: time
        after: '06:00:00'
        before: '8:00:00'
    action:
      - service: script.scene_retry
        data:
          scene_entity_id: scene.bright_downstairs

  - alias: Turn on downstains lights morning
    hide_entity: false
    trigger:
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_1_sensor
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_2_sensor
        from: 'off'
        to: 'on'
    condition:
      - condition: state
        entity_id: input_boolean.disable_downstairs_motion
        state: 'off'
      - condition: state
        entity_id: group.downstairs_all_lights
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.downstairs_motion_detector_1_luminance
        below: '18'
      - condition: time
        after: '08:00:00'
        before: '12:00:00'
    action:
      - service: script.scene_retry
        data:
          scene_entity_id: scene.energize_downstairs

  - alias: Turn on downstains lights afternoon
    hide_entity: false
    trigger:
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_1_sensor
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_2_sensor
        from: 'off'
        to: 'on'
    condition:
      - condition: state
        entity_id: input_boolean.disable_downstairs_motion
        state: 'off'
      - condition: state
        entity_id: group.downstairs_all_lights
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.downstairs_motion_detector_1_luminance
        below: '18'
      - condition: time
        after: '12:00:00'
        before: '19:00:00'
    action:
      - service: script.scene_retry
        data:
          scene_entity_id: scene.concentrate_downstairs

  - alias: Turn on downstains lights evening
    hide_entity: false
    trigger:
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_1_sensor
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_2_sensor
        from: 'off'
        to: 'on'
    condition:
      - condition: state
        entity_id: input_boolean.disable_downstairs_motion
        state: 'off'
      - condition: state
        entity_id: group.downstairs_all_lights
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.downstairs_motion_detector_1_luminance
        below: '18'
      - condition: time
        after: '19:00:00'
        before: '22:00:00'
    action:
      - service: script.scene_retry
        data:
          scene_entity_id: scene.relax_downstairs

  - alias: Turn on downstains lights night
    hide_entity: false
    trigger:
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_1_sensor
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.downstairs_motion_detector_2_sensor
        from: 'off'
        to: 'on'
    condition:
      - condition: state
        entity_id: input_boolean.disable_downstairs_motion
        state: 'off'
      - condition: state
        entity_id: group.downstairs_all_lights
        state: 'off'
      - condition: numeric_state
        entity_id: sensor.downstairs_motion_detector_1_luminance
        below: '18'
      - condition: time
        after: '22:00:00'
        before: '06:00:00'
    action:
      - service: script.scene_retry
        data:
          scene_entity_id: scene.nightlight_downstairs

  - alias: Turn off downstains lights
    trigger:
      - platform: time_pattern
        seconds: '/60'
    condition:
      - condition: state
        entity_id: group.downstairs_all_lights
        state: 'on'
      - condition: state
        entity_id: binary_sensor.downstairs_motion_detector_1_sensor
        state: 'off'
        for:
          minutes: 30
      - condition: state
        entity_id: binary_sensor.downstairs_motion_detector_2_sensor
        state: 'off'
        for:
          minutes: 30
      - condition: state
        entity_id: input_boolean.disable_downstairs_motion
        state: 'off'
      - condition: state
        entity_id: media_player.vizio_smartcast
        state: 'off'
        for:
          minutes: 15
      - condition: time
        before: '19:00:00'
        after: '22:00:00'
    action:
      - service: script.turn_off_group_with_retry
        data:
          group_entity_id: group.downstairs_all_lights
      - service: notify.ios_rich_iphone
        data:
          message: "No motion for 30 minutes turning of downstairs lights"

  - alias: 'last_motion_update'
    trigger:
      - platform: time_pattern
        seconds: '/30'
    action:
      - service: homeassistant.update_entity
        entity_id: sensor.downstairs_last_motion
      - service: homeassistant.update_entity
        entity_id: sensor.downstairs_last_motion_1
      - service: homeassistant.update_entity
        entity_id: sensor.downstairs_last_motion_2

  - alias: Low Battery Alert - Downstairs Motion Detector One
    trigger:
      - platform: template
        value_template: '{{ states.sensor.battery_downstairs_motion_detector_1.state | int > 1 and states.sensor.battery_downstairs_motion_detector_1.state | int < 5 }}'
    action:
      - service: notify.ios_rich_iphone
        data_template:
          message: >
            Low Battery Alert - Downstairs Motion Detector One is at {{ states.sensor.battery_downstairs_motion_detector_1.state }} %

  - alias: Low Battery Alert - Downstairs Motion Detector Two
    trigger:
      - platform: template
        value_template: '{{ states.sensor.battery_downstairs_motion_detector_2.state | int > 1 and states.sensor.battery_downstairs_motion_detector_2.state | int < 5 }}'
    action:
      - service: notify.ios_rich_iphone
        data_template:
          message: >
            Low Battery Alert - Downstairs Motion Detector Two is at {{ states.sensor.battery_downstairs_motion_detector_1.state }} %